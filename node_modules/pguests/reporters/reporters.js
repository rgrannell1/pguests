
"use strict"





const constants = require('pguests/commons/constants')





const reporters = { }





reporters.reportRates = received =>{

	var sockets = received.map(socket => {

		var reformatted = {
			local:     socket.local_address,
			remote:    socket.remote_address || socket.rem_address,
			metadata:  socket.metadata
		}

		return reformatted

	})

	var profiles = sockets.reduce((acc, socket) => {

		var localAddress = `${socket.local.ip}:${socket.local.port}`

		if (!acc.hasOwnProperty(socket.remote.ip)) {

			acc[socket.remote.ip] = {

				[socket.remote.port]: [{
					local:    socket.local,
					metadata: socket.metadata
				}]

			}

		} else if (acc[socket.remote.ip] && acc[socket.remote.ip][socket.remote.port]) {

			if (acc[socket.remote.ip][socket.remote.port].indexOf(localAddress) === -1) {

				acc[socket.remote.ip][socket.remote.port].push({
					local:    socket.local,
					metadata: socket.metadata
				})

			}

		}

		return acc

	}, { })

	Object.keys(profiles).forEach(remoteIp => {

		const profile = profiles[remoteIp]

		console.log(remoteIp)

		Object.keys(profiles[remoteIp]).forEach(port => {

			profiles[remoteIp][port].forEach(conn => {

				console.log(`    ${conn.local.ip}:${conn.local.port}`)

			})

		})


	})

}





module.exports = reporters
